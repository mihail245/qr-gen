<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Полнофункциональный генератор и сканер QR-кодов</title>
    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
    <style>
        :root {
            --primary-color: #4285f4;
            --secondary-color: #34a853;
            --accent-color: #ea4335;
            --light-color: #f8f9fa;
            --dark-color: #202124;
            --gray-color: #5f6368;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-color);
            color: var(--dark-color);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            transition: var(--transition);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2rem;
            color: var(--gray-color);
            margin-bottom: 20px;
        }

        .app-description {
            max-width: 800px;
            margin: 0 auto 30px;
            text-align: center;
            color: var(--gray-color);
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray-color);
            transition: var(--transition);
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }

        .tab:hover:not(.active) {
            color: var(--dark-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--dark-color);
            text-align: center;
        }

        .card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 30px;
            margin-bottom: 30px;
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }

        input, textarea, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        input:focus, textarea:focus, select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        .btn {
            display: inline-block;
            padding: 12px 24px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .btn:hover {
            background-color: #3367d6;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
        }

        .btn-secondary:hover {
            background-color: #2d9249;
        }

        .btn-danger {
            background-color: var(--accent-color);
        }

        .btn-danger:hover {
            background-color: #d33426;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .qr-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 30px;
        }

        #qrcode {
            margin: 20px 0;
            padding: 20px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .qr-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .scanner-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }

        #scanner-video {
            width: 100%;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            background-color: #000;
        }

        #scanner-canvas {
            display: none;
        }

        .scanner-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            border: 2px solid var(--primary-color);
            border-radius: var(--border-radius);
            box-sizing: border-box;
        }

        .scanner-result {
            margin-top: 20px;
            padding: 15px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            word-break: break-all;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .option-item {
            background-color: white;
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .option-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dark-color);
        }

        .color-picker {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .color-picker input[type="color"] {
            width: 50px;
            height: 40px;
            padding: 2px;
            cursor: pointer;
        }

        .history-list {
            list-style: none;
        }

        .history-item {
            padding: 15px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-content {
            flex: 1;
            margin-right: 15px;
            word-break: break-all;
        }

        .history-actions {
            display: flex;
            gap: 5px;
        }

        .history-btn {
            padding: 5px 10px;
            background-color: #f1f3f4;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: var(--transition);
        }

        .history-btn:hover {
            background-color: #e0e0e0;
        }

        .history-date {
            font-size: 0.8rem;
            color: var(--gray-color);
            margin-top: 5px;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray-color);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            color: #dadce0;
        }

        footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            color: var(--gray-color);
        }

        @media (max-width: 768px) {
            .options-grid {
                grid-template-columns: 1fr;
            }

            .btn-group {
                flex-direction: column;
            }

            .qr-actions, .history-actions {
                flex-direction: column;
                gap: 5px;
            }
        }

        /* Анимации */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        /* Дополнительные стили для улучшения UX */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--dark-color);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
            font-weight: normal;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Стили для модального окна */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            overflow: auto;
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 90%;
            animation: modalFadeIn 0.3s;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5rem;
            color: var(--dark-color);
        }

        .close-modal {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--gray-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .close-modal:hover {
            color: var(--dark-color);
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Стили для вкладок настроек */
        .settings-tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }

        .settings-tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: var(--transition);
        }

        .settings-tab.active {
            border-bottom: 3px solid var(--primary-color);
            color: var(--primary-color);
        }

        .settings-content {
            display: none;
        }

        .settings-content.active {
            display: block;
        }

        /* Стили для переключателей */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .switch-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .switch-label {
            font-weight: normal;
            color: var(--dark-color);
        }

        /* Стили для диапазона */
        .range-container {
            margin-bottom: 15px;
        }

        .range-label {
            display: block;
            margin-bottom: 5px;
        }

        .range-input {
            width: 100%;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 4px;
            background: #ddd;
            outline: none;
        }

        .range-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
        }

        .range-input::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
        }

        .range-value {
            display: inline-block;
            margin-left: 10px;
            font-weight: bold;
        }

        /* Стили для таблицы истории */
        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .history-table th, .history-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .history-table th {
            background-color: #f1f3f4;
            font-weight: 600;
            color: var(--dark-color);
        }

        .history-table tr:hover {
            background-color: #f8f9fa;
        }

        .table-actions {
            display: flex;
            gap: 5px;
        }

        /* Стили для уведомлений */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: var(--primary-color);
            color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            transform: translateX(150%);
            transition: transform 0.3s ease;
            z-index: 1000;
            max-width: 300px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background-color: var(--secondary-color);
        }

        .notification.error {
            background-color: var(--accent-color);
        }

        .notification-warning {
            background-color: #fbbc05;
        }

        /* Дополнительные элементы интерфейса */
        .divider {
            height: 1px;
            background-color: rgba(0, 0, 0, 0.1);
            margin: 20px 0;
        }

        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            background-color: var(--primary-color);
            color: white;
        }

        .badge.secondary {
            background-color: var(--secondary-color);
        }

        .badge.accent {
            background-color: var(--accent-color);
        }

        .badge.gray {
            background-color: var(--gray-color);
        }

        /* Адаптивные медиа-запросы */
        @media (max-width: 480px) {
            h1 {
                font-size: 2rem;
            }

            .subtitle {
                font-size: 1rem;
            }

            .card {
                padding: 20px 15px;
            }

            .tabs {
                flex-wrap: wrap;
            }

            .tab {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
        }

        /* Специфические стили для генератора QR */
        .qr-preview-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 300px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 20px;
            position: relative;
        }

        .qr-preview-placeholder {
            text-align: center;
            color: var(--gray-color);
            padding: 40px;
        }

        .qr-size-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .qr-size-input {
            width: 80px;
            text-align: center;
        }

        /* Стили для сканера QR */
        .scanner-instructions {
            background-color: #e8f0fe;
            color: var(--primary-color);
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .scanner-status {
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--gray-color);
        }

        /* Стили для страницы информации */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .info-card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
        }

        .info-card-title {
            font-size: 1.2rem;
            color: var(--primary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-card-icon {
            font-size: 1.5rem;
        }

        /* Стили для темной темы */
        .dark-theme {
            background-color: #121212;
            color: #e0e0e0;
        }

        .dark-theme .card,
        .dark-theme .option-item,
        .dark-theme .history-item,
        .dark-theme .scanner-result,
        .dark-theme .modal-content,
        .dark-theme .info-card,
        .dark-theme .qr-preview-container,
        .dark-theme #qrcode {
            background-color: #1e1e1e;
            color: #e0e0e0;
        }

        .dark-theme input,
        .dark-theme textarea,
        .dark-theme select {
            background-color: #2d2d2d;
            border-color: #444;
            color: #e0e0e0;
        }

        .dark-theme label,
        .dark-theme .option-title,
        .dark-theme .modal-title,
        .dark-theme .section-title,
        .dark-theme .switch-label,
        .dark-theme .range-label {
            color: #e0e0e0;
        }

        .dark-theme .history-table th {
            background-color: #2d2d2d;
            color: #e0e0e0;
        }

        .dark-theme .history-table tr:hover {
            background-color: #2d2d2d;
        }

        .dark-theme .divider {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .dark-theme header,
        .dark-theme footer {
            border-color: rgba(255, 255, 255, 0.1);
        }

        .dark-theme .tabs,
        .dark-theme .settings-tabs {
            border-color: rgba(255, 255, 255, 0.1);
        }

        .dark-theme .tab {
            color: #9e9e9e;
        }

        .dark-theme .tab:hover:not(.active) {
            color: #e0e0e0;
        }

        .dark-theme .history-btn {
            background-color: #2d2d2d;
            color: #e0e0e0;
        }

        .dark-theme .history-btn:hover {
            background-color: #3d3d3d;
        }

        .dark-theme .tooltip .tooltiptext {
            background-color: #333;
            color: #e0e0e0;
        }

        .dark-theme .empty-state {
            color: #9e9e9e;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>QR Code Generator & Scanner</h1>
            <p class="subtitle">Создавайте и сканируйте QR-коды бесплатно</p>
            <p class="app-description">
                Мощный инструмент для генерации QR-кодов с настройками и сканирования QR-кодов прямо в вашем браузере.
                Не требует установки, работает полностью на вашем устройстве.
            </p>
        </header>

        <div class="tabs">
            <div class="tab active" data-tab="generator">Генератор QR</div>
            <div class="tab" data-tab="scanner">Сканер QR</div>
            <div class="tab" data-tab="history">История</div>
            <div class="tab" data-tab="settings">Настройки</div>
            <div class="tab" data-tab="info">Информация</div>
        </div>

        <!-- Генератор QR-кодов -->
        <div id="generator" class="tab-content active">
            <div class="card">
                <h2 class="section-title">Создать QR-код</h2>
                <div class="form-group">
                    <label for="qr-content">Содержимое QR-кода:</label>
                    <textarea id="qr-content" placeholder="Введите текст, URL или другие данные для кодирования в QR-код"></textarea>
                </div>

                <div class="options-grid">
                    <div class="option-item">
                        <div class="option-title">Цвета</div>
                        <div class="form-group">
                            <label for="qr-color">Цвет QR-кода:</label>
                            <div class="color-picker">
                                <input type="color" id="qr-color" value="#000000">
                                <span id="qr-color-value">#000000</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="qr-bg-color">Фоновый цвет:</label>
                            <div class="color-picker">
                                <input type="color" id="qr-bg-color" value="#ffffff">
                                <span id="qr-bg-color-value">#FFFFFF</span>
                            </div>
                        </div>
                    </div>

                    <div class="option-item">
                        <div class="option-title">Размер и коррекция</div>
                        <div class="form-group">
                            <label for="qr-size">Размер (пикселей):</label>
                            <input type="number" id="qr-size" min="100" max="1000" value="200">
                        </div>
                        <div class="form-group">
                            <label for="qr-ecc">Коррекция ошибок:</label>
                            <select id="qr-ecc">
                                <option value="L">Низкая (7%)</option>
                                <option value="M" selected>Средняя (15%)</option>
                                <option value="Q">Высокая (25%)</option>
                                <option value="H">Максимальная (30%)</option>
                            </select>
                        </div>
                    </div>

                    <div class="option-item">
                        <div class="option-title">Дополнительные настройки</div>
                        <div class="switch-container">
                            <label class="switch">
                                <input type="checkbox" id="qr-logo-enabled">
                                <span class="slider"></span>
                            </label>
                            <span class="switch-label">Добавить логотип</span>
                        </div>
                        <div class="form-group" id="qr-logo-options" style="display: none;">
                            <label for="qr-logo-url">URL логотипа:</label>
                            <input type="text" id="qr-logo-url" placeholder="https://example.com/logo.png">
                            <label for="qr-logo-size">Размер логотипа (%):</label>
                            <input type="number" id="qr-logo-size" min="5" max="30" value="15">
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                    <button id="generate-btn" class="btn">Сгенерировать QR-код</button>
                    <button id="clear-btn" class="btn btn-danger">Очистить</button>
                </div>
            </div>

            <div class="card">
                <h2 class="section-title">Предпросмотр QR-кода</h2>
                <div class="qr-preview-container">
                    <div id="qrcode" style="display: none;"></div>
                    <div id="qr-placeholder" class="qr-preview-placeholder">
                        <p>Ваш QR-код появится здесь после генерации</p>
                    </div>
                </div>

                <div class="qr-actions">
                    <button id="download-png" class="btn" disabled>Скачать PNG</button>
                    <button id="download-svg" class="btn" disabled>Скачать SVG</button>
                    <button id="save-to-history" class="btn btn-secondary" disabled>Сохранить в историю</button>
                    <button id="copy-qr" class="btn" disabled>Копировать</button>
                </div>
            </div>
        </div>

        <!-- Сканер QR-кодов -->
        <div id="scanner" class="tab-content">
            <div class="card">
                <h2 class="section-title">Сканировать QR-код</h2>
                <div class="scanner-instructions">
                    <p>Наведите камеру на QR-код для сканирования. Убедитесь, что код хорошо освещен и полностью попадает в рамку.</p>
                </div>

                <div class="scanner-container">
                    <video id="scanner-video" playsinline></video>
                    <canvas id="scanner-canvas"></canvas>
                    <div class="scanner-overlay"></div>
                </div>

                <div class="scanner-status" id="scanner-status">Ожидание камеры...</div>

                <div class="btn-group">
                    <button id="start-scanner" class="btn">Запустить сканер</button>
                    <button id="stop-scanner" class="btn btn-danger" disabled>Остановить сканер</button>
                    <button id="upload-image" class="btn btn-secondary">Загрузить изображение</button>
                    <input type="file" id="file-input" accept="image/*" style="display: none;">
                </div>
            </div>

            <div class="card">
                <h2 class="section-title">Результат сканирования</h2>
                <div class="scanner-result" id="scanner-result">
                    <p>Здесь будет отображаться результат сканирования QR-кода.</p>
                </div>

                <div class="btn-group">
                    <button id="copy-result" class="btn" disabled>Копировать результат</button>
                    <button id="clear-result" class="btn btn-danger">Очистить</button>
                </div>
            </div>
        </div>

        <!-- История QR-кодов -->
        <div id="history" class="tab-content">
            <div class="card">
                <h2 class="section-title">История QR-кодов</h2>
                <div class="form-group">
                    <input type="text" id="history-search" placeholder="Поиск по истории...">
                </div>

                <div id="history-list-container">
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>Дата</th>
                                <th>Содержимое</th>
                                <th>Тип</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody id="history-list">
                            <!-- История будет загружена здесь -->
                        </tbody>
                    </table>
                </div>

                <div id="empty-history" class="empty-state">
                    <div class="empty-state-icon">📭</div>
                    <h3>История пуста</h3>
                    <p>Здесь будут отображаться ранее созданные QR-коды и результаты сканирования.</p>
                </div>

                <div class="btn-group">
                    <button id="clear-history" class="btn btn-danger">Очистить историю</button>
                    <button id="export-history" class="btn btn-secondary">Экспорт истории</button>
                </div>
            </div>
        </div>

        <!-- Настройки -->
        <div id="settings" class="tab-content">
            <div class="card">
                <h2 class="section-title">Настройки приложения</h2>
                
                <div class="settings-tabs">
                    <div class="settings-tab active" data-settings-tab="general">Общие</div>
                    <div class="settings-tab" data-settings-tab="generator">Генератор</div>
                    <div class="settings-tab" data-settings-tab="scanner">Сканер</div>
                    <div class="settings-tab" data-settings-tab="privacy">Конфиденциальность</div>
                </div>

                <div id="general-settings" class="settings-content active">
                    <div class="switch-container">
                        <label class="switch">
                            <input type="checkbox" id="dark-mode">
                            <span class="slider"></span>
                        </label>
                        <span class="switch-label">Темная тема</span>
                    </div>

                    <div class="switch-container">
                        <label class="switch">
                            <input type="checkbox" id="save-history" checked>
                            <span class="slider"></span>
                        </label>
                        <span class="switch-label">Сохранять историю</span>
                    </div>

                    <div class="switch-container">
                        <label class="switch">
                            <input type="checkbox" id="notifications" checked>
                            <span class="slider"></span>
                        </label>
                        <span class="switch-label">Показывать уведомления</span>
                    </div>

                    <div class="form-group">
                        <label for="history-limit">Лимит записей в истории:</label>
                        <div class="range-container">
                            <input type="range" id="history-limit" min="10" max="500" value="100" class="range-input">
                            <span id="history-limit-value" class="range-value">100</span>
                        </div>
                    </div>
                </div>

                <div id="generator-settings" class="settings-content">
                    <div class="switch-container">
                        <label class="switch">
                            <input type="checkbox" id="auto-generate" checked>
                            <span class="slider"></span>
                        </label>
                        <span class="switch-label">Автогенерация при изменении</span>
                    </div>

                    <div class="form-group">
                        <label for="default-qr-size">Размер QR-кода по умолчанию:</label>
                        <input type="number" id="default-qr-size" min="100" max="1000" value="200">
                    </div>

                    <div class="form-group">
                        <label for="default-ecc">Коррекция ошибок по умолчанию:</label>
                        <select id="default-ecc">
                            <option value="L">Низкая (7%)</option>
                            <option value="M" selected>Средняя (15%)</option>
                            <option value="Q">Высокая (25%)</option>
                            <option value="H">Максимальная (30%)</option>
                        </select>
                    </div>
                </div>

                <div id="scanner-settings" class="settings-content">
                    <div class="switch-container">
                        <label class="switch">
                            <input type="checkbox" id="auto-scan" checked>
                            <span class="slider"></span>
                        </label>
                        <span class="switch-label">Автосканирование</span>
                    </div>

                    <div class="switch-container">
                        <label class="switch">
                            <input type="checkbox" id="beep-on-scan" checked>
                            <span class="slider"></span>
                        </label>
                        <span class="switch-label">Звук при сканировании</span>
                    </div>

                    <div class="form-group">
                        <label for="camera-resolution">Разрешение камеры:</label>
                        <select id="camera-resolution">
                            <option value="auto">Автоматическое</option>
                            <option value="hd">HD (1280x720)</option>
                            <option value="full-hd">Full HD (1920x1080)</option>
                            <option value="4k">4K (3840x2160)</option>
                        </select>
                    </div>
                </div>

                <div id="privacy-settings" class="settings-content">
                    <div class="switch-container">
                        <label class="switch">
                            <input type="checkbox" id="analytics" checked>
                            <span class="slider"></span>
                        </label>
                        <span class="switch-label">Отправлять анонимную статистику</span>
                    </div>

                    <div class="switch-container">
                        <label class="switch">
                            <input type="checkbox" id="save-to-local" checked>
                            <span class="slider"></span>
                        </label>
                        <span class="switch-label">Сохранять данные локально</span>
                    </div>

                    <p class="privacy-notice">
                        Это приложение работает полностью на вашем устройстве. Никакие данные не отправляются на сервер без вашего согласия.
                    </p>

                    <div class="btn-group">
                        <button id="clear-all-data" class="btn btn-danger">Удалить все данные</button>
                        <button id="export-all-data" class="btn btn-secondary">Экспорт всех данных</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Информация -->
        <div id="info" class="tab-content">
            <div class="card">
                <h2 class="section-title">О приложении QR Code Generator & Scanner</h2>
                <p>
                    Это бесплатное веб-приложение позволяет создавать и сканировать QR-коды прямо в вашем браузере.
                    Приложение не требует установки и работает полностью на вашем устройстве, что гарантирует конфиденциальность ваших данных.
                </p>

                <div class="info-grid">
                    <div class="info-card">
                        <h3 class="info-card-title">
                            <span class="info-card-icon">🔄</span>
                            Как это работает
                        </h3>
                        <p>
                            Генератор QR-кодов использует библиотеку QRCode.js для преобразования вашего текста или URL в QR-код.
                            Сканер использует jsQR для декодирования QR-кодов с камеры или изображений.
                        </p>
                    </div>

                    <div class="info-card">
                        <h3 class="info-card-title">
                            <span class="info-card-icon">🔒</span>
                            Конфиденциальность
                        </h3>
                        <p>
                            Все данные обрабатываются локально в вашем браузере. Никакая информация не отправляется на серверы.
                            Вы можете использовать это приложение без опасений за безопасность ваших данных.
                        </p>
                    </div>

                    <div class="info-card">
                        <h3 class="info-card-title">
                            <span class="info-card-icon">💡</span>
                            Советы по использованию
                        </h3>
                        <ul>
                            <li>Для URL используйте полный адрес (с https://)</li>
                            <li>Чем больше данных, тем сложнее QR-код</li>
                            <li>Используйте высокую коррекцию ошибок для печати</li>
                            <li>Для сканирования обеспечьте хорошее освещение</li>
                        </ul>
                    </div>

                    <div class="info-card">
                        <h3 class="info-card-title">
                            <span class="info-card-icon">ℹ️</span>
                            О QR-кодах
                        </h3>
                        <p>
                            QR-код (Quick Response Code) — это матричный код, разработанный в 1994 году японской компанией Denso Wave.
                            Может содержать до 4296 символов и поддерживает различные типы данных.
                        </p>
                    </div>
                </div>

                <div class="divider"></div>

                <h3 class="section-title">Техническая информация</h3>
                <p>
                    <strong>Версия:</strong> 1.4.8.7<br>
                    <strong>Поддержка:</strong> Все современные браузеры
                </p>
            </div>
        </div>

        <!-- Уведомления -->
        <div id="notification" class="notification">
            <div id="notification-message">Уведомление</div>
        </div>

        <!-- Модальное окно -->
        <div id="modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="modal-title">Модальное окно</h3>
                    <span class="close-modal">&times;</span>
                </div>
                <div class="modal-body" id="modal-body">
                    Содержимое модального окна
                </div>
                <div class="modal-footer">
                    <button id="modal-cancel" class="btn btn-danger">Отмена</button>
                    <button id="modal-confirm" class="btn">Подтвердить</button>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>Пихта &copy; 2025 | Все права защищены</p>
        <p>Работает полностью в вашем браузере | Не требует интернета</p>
    </footer>

    <script>
        // Основной код приложения
        document.addEventListener('DOMContentLoaded', function() {
            // Элементы интерфейса
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            const settingsTabs = document.querySelectorAll('.settings-tab');
            const settingsContents = document.querySelectorAll('.settings-content');
            const generateBtn = document.getElementById('generate-btn');
            const clearBtn = document.getElementById('clear-btn');
            const qrContent = document.getElementById('qr-content');
            const qrColor = document.getElementById('qr-color');
            const qrBgColor = document.getElementById('qr-bg-color');
            const qrSize = document.getElementById('qr-size');
            const qrEcc = document.getElementById('qr-ecc');
            const qrLogoEnabled = document.getElementById('qr-logo-enabled');
            const qrLogoOptions = document.getElementById('qr-logo-options');
            const qrLogoUrl = document.getElementById('qr-logo-url');
            const qrLogoSizer = document.getElementById('qr-logo-size');
            const qrcodeDiv = document.getElementById('qrcode');
            const qrPlaceholder = document.getElementById('qr-placeholder');
            const downloadPng = document.getElementById('download-png');
            const downloadSvg = document.getElementById('download-svg');
            const saveToHistory = document.getElementById('save-to-history');
            const copyQr = document.getElementById('copy-qr');
            const startScanner = document.getElementById('start-scanner');
            const stopScanner = document.getElementById('stop-scanner');
            const uploadImage = document.getElementById('upload-image');
            const fileInput = document.getElementById('file-input');
            const scannerVideo = document.getElementById('scanner-video');
            const scannerCanvas = document.getElementById('scanner-canvas');
            const scannerResult = document.getElementById('scanner-result');
            const copyResult = document.getElementById('copy-result');
            const clearResult = document.getElementById('clear-result');
            const scannerStatus = document.getElementById('scanner-status');
            const historySearch = document.getElementById('history-search');
            const historyList = document.getElementById('history-list');
            const emptyHistory = document.getElementById('empty-history');
            const clearHistory = document.getElementById('clear-history');
            const exportHistory = document.getElementById('export-history');
            const darkMode = document.getElementById('dark-mode');
            const saveHistory = document.getElementById('save-history');
            const notifications = document.getElementById('notifications');
            const historyLimit = document.getElementById('history-limit');
            const historyLimitValue = document.getElementById('history-limit-value');
            const autoGenerate = document.getElementById('auto-generate');
            const defaultQrSize = document.getElementById('default-qr-size');
            const defaultEcc = document.getElementById('default-ecc');
            const autoScan = document.getElementById('auto-scan');
            const beepOnScan = document.getElementById('beep-on-scan');
            const cameraResolution = document.getElementById('camera-resolution');
            const analytics = document.getElementById('analytics');
            const saveToLocal = document.getElementById('save-to-local');
            const clearAllData = document.getElementById('clear-all-data');
            const exportAllData = document.getElementById('export-all-data');
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');
            const modalCancel = document.getElementById('modal-cancel');
            const modalConfirm = document.getElementById('modal-confirm');
            const closeModal = document.querySelector('.close-modal');
            const notification = document.getElementById('notification');
            const notificationMessage = document.getElementById('notification-message');

            // Переменные состояния
            let qrCode = null;
            let scannerInterval = null;
            let scannerStream = null;
            let history = [];
            let settings = {
                darkMode: false,
                saveHistory: true,
                notifications: true,
                historyLimit: 100,
                autoGenerate: true,
                defaultQrSize: 200,
                defaultEcc: 'M',
                autoScan: true,
                beepOnScan: true,
                cameraResolution: 'auto',
                analytics: true,
                saveToLocal: true
            };

            // Инициализация приложения
            function initApp() {
                loadSettings();
                setupEventListeners();
                updateUI();
                checkHistory();
            }

            // Загрузка настроек из localStorage
            function loadSettings() {
                const savedSettings = localStorage.getItem('qrAppSettings');
                if (savedSettings) {
                    settings = JSON.parse(savedSettings);
                    applySettings();
                }
            }

            // Применение загруженных настроек
            function applySettings() {
                // Общие настройки
                darkMode.checked = settings.darkMode;
                saveHistory.checked = settings.saveHistory;
                notifications.checked = settings.notifications;
                historyLimit.value = settings.historyLimit;
                historyLimitValue.textContent = settings.historyLimit;

                // Настройки генератора
                autoGenerate.checked = settings.autoGenerate;
                defaultQrSize.value = settings.defaultQrSize;
                qrSize.value = settings.defaultQrSize;
                defaultEcc.value = settings.defaultEcc;
                qrEcc.value = settings.defaultEcc;

                // Настройки сканера
                autoScan.checked = settings.autoScan;
                beepOnScan.checked = settings.beepOnScan;
                cameraResolution.value = settings.cameraResolution;

                // Настройки конфиденциальности
                analytics.checked = settings.analytics;
                saveToLocal.checked = settings.saveToLocal;

                // Применение темы
                toggleDarkTheme(settings.darkMode);
            }

            // Сохранение настроек в localStorage
            function saveSettings() {
                localStorage.setItem('qrAppSettings', JSON.stringify(settings));
                showNotification('Настройки сохранены', 'success');
            }

            // Переключение темной темы
            function toggleDarkTheme(enable) {
                if (enable) {
                    document.body.classList.add('dark-theme');
                } else {
                    document.body.classList.remove('dark-theme');
                }
            }

            // Настройка обработчиков событий
            function setupEventListeners() {
                // Переключение вкладок
                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        tabs.forEach(t => t.classList.remove('active'));
                        tabContents.forEach(c => c.classList.remove('active'));
                        tab.classList.add('active');
                        document.getElementById(tab.dataset.tab).classList.add('active');
                    });
                });

                // Переключение вкладок настроек
                settingsTabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        settingsTabs.forEach(t => t.classList.remove('active'));
                        settingsContents.forEach(c => c.classList.remove('active'));
                        tab.classList.add('active');
                        document.getElementById(`${tab.dataset.settingsTab}-settings`).classList.add('active');
                    });
                });

                // Генератор QR-кодов
                generateBtn.addEventListener('click', generateQRCode);
                clearBtn.addEventListener('click', clearGenerator);
                qrContent.addEventListener('input', handleContentInput);
                qrColor.addEventListener('input', updateColorValue);
                qrBgColor.addEventListener('input', updateBgColorValue);
                qrSize.addEventListener('input', updateQrSize);
                qrEcc.addEventListener('change', updateQrEcc);
                qrLogoEnabled.addEventListener('change', toggleLogoOptions);
                qrLogoUrl.addEventListener('input', updateLogoUrl);
                qrLogoSizer.addEventListener('input', updateLogoSize);
                downloadPng.addEventListener('click', downloadQRAsPNG);
                downloadSvg.addEventListener('click', downloadQRAsSVG);
                saveToHistory.addEventListener('click', saveQRToHistory);
                copyQr.addEventListener('click', copyQRToClipboard);

                // Сканер QR-кодов
                startScanner.addEventListener('click', startQRScanner);
                stopScanner.addEventListener('click', stopQRScanner);
                uploadImage.addEventListener('click', () => fileInput.click());
                fileInput.addEventListener('change', handleFileUpload);
                copyResult.addEventListener('click', copyResultToClipboard);
                clearResult.addEventListener('click', clearScannerResult);

                // История
                historySearch.addEventListener('input', searchHistory);
                clearHistory.addEventListener('click', confirmClearHistory);
                exportHistory.addEventListener('click', exportHistoryData);

                // Настройки
                darkMode.addEventListener('change', toggleDarkMode);
                saveHistory.addEventListener('change', toggleSaveHistory);
                notifications.addEventListener('change', toggleNotifications);
                historyLimit.addEventListener('input', updateHistoryLimit);
                autoGenerate.addEventListener('change', toggleAutoGenerate);
                defaultQrSize.addEventListener('change', updateDefaultQrSize);
                defaultEcc.addEventListener('change', updateDefaultEcc);
                autoScan.addEventListener('change', toggleAutoScan);
                beepOnScan.addEventListener('change', toggleBeepOnScan);
                cameraResolution.addEventListener('change', updateCameraResolution);
                analytics.addEventListener('change', toggleAnalytics);
                saveToLocal.addEventListener('change', toggleSaveToLocal);
                clearAllData.addEventListener('click', confirmClearAllData);
                exportAllData.addEventListener('click', exportAllAppData);

                // Модальное окно
                modalCancel.addEventListener('click', closeModalWindow);
                modalConfirm.addEventListener('click', confirmModalAction);
                closeModal.addEventListener('click', closeModalWindow);
                window.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeModalWindow();
                    }
                });
            }

            // Обновление интерфейса
            function updateUI() {
                updateColorValue();
                updateBgColorValue();
                toggleLogoOptions();
            }

            // Генерация QR-кода
            function generateQRCode() {
                const content = qrContent.value.trim();
                if (!content) {
                    showNotification('Введите содержимое для QR-кода', 'error');
                    return;
                }

                const color = qrColor.value;
                const bgColor = qrBgColor.value;
                const size = parseInt(qrSize.value);
                const ecc = qrEcc.value;

                qrcodeDiv.innerHTML = '';
                qrPlaceholder.style.display = 'none';
                qrcodeDiv.style.display = 'block';

                qrCode = new QRCode(qrcodeDiv, {
                    text: content,
                    width: size,
                    height: size,
                    colorDark: color,
                    colorLight: bgColor,
                    correctLevel: QRCode.CorrectLevel[ecc]
                });

                // Добавление логотипа, если включено
                if (qrLogoEnabled.checked && qrLogoUrl.value.trim()) {
                    setTimeout(() => {
                        addLogoToQR(qrLogoUrl.value.trim(), parseInt(qrLogoSizer.value));
                    }, 100);
                }

                // Активация кнопок
                downloadPng.disabled = false;
                downloadSvg.disabled = false;
                saveToHistory.disabled = false;
                copyQr.disabled = false;

                showNotification('QR-код успешно сгенерирован', 'success');
            }

            // Добавление логотипа к QR-коду
            function addLogoToQR(logoUrl, sizePercent) {
                const canvas = qrcodeDiv.querySelector('canvas');
                if (!canvas) return;

                const img = new Image();
                img.crossOrigin = 'Anonymous';
                img.onload = function() {
                    const ctx = canvas.getContext('2d');
                    const qrSize = canvas.width;
                    const logoSize = qrSize * (sizePercent / 100);
                    const logoPos = (qrSize - logoSize) / 2;

                    // Сохраняем исходные данные QR-кода
                    const imageData = ctx.getImageData(0, 0, qrSize, qrSize);

                    // Рисуем логотип
                    ctx.fillStyle = qrBgColor.value;
                    ctx.fillRect(logoPos - 5, logoPos - 5, logoSize + 10, logoSize + 10);
                    ctx.drawImage(img, logoPos, logoPos, logoSize, logoSize);

                    // Восстанавливаем данные QR-кода вокруг логотипа
                    for (let y = 0; y < qrSize; y++) {
                        for (let x = 0; x < qrSize; x++) {
                            // Если пиксель находится за пределами области логотипа, пропускаем
                            if (x >= logoPos - 10 && x <= logoPos + logoSize + 10 &&
                                y >= logoPos - 10 && y <= logoPos + logoSize + 10) {
                                continue;
                            }
                            
                            const idx = (y * qrSize + x) * 4;
                            ctx.fillStyle = `rgba(${imageData.data[idx]}, ${imageData.data[idx+1]}, ${imageData.data[idx+2]}, ${imageData.data[idx+3]/255})`;
                            ctx.fillRect(x, y, 1, 1);
                        }
                    }
                };
                img.onerror = function() {
                    showNotification('Ошибка загрузки логотипа', 'error');
                };
                img.src = logoUrl;
            }

            // Очистка генератора
            function clearGenerator() {
                qrContent.value = '';
                qrColor.value = '#000000';
                qrBgColor.value = '#ffffff';
                qrSize.value = settings.defaultQrSize;
                qrEcc.value = settings.defaultEcc;
                qrLogoEnabled.checked = false;
                qrLogoUrl.value = '';
                qrLogoSizer.value = '15';
                qrcodeDiv.innerHTML = '';
                qrcodeDiv.style.display = 'none';
                qrPlaceholder.style.display = 'block';
                downloadPng.disabled = true;
                downloadSvg.disabled = true;
                saveToHistory.disabled = true;
                copyQr.disabled = true;
                toggleLogoOptions();
                updateColorValue();
                updateBgColorValue();
            }

            // Обработка ввода содержимого
            function handleContentInput() {
                if (settings.autoGenerate && qrContent.value.trim()) {
                    generateQRCode();
                }
            }

            // Обновление значения цвета
            function updateColorValue() {
                document.getElementById('qr-color-value').textContent = qrColor.value.toUpperCase();
                if (qrCode && qrContent.value.trim()) {
                    generateQRCode();
                }
            }

            // Обновление значения фонового цвета
            function updateBgColorValue() {
                document.getElementById('qr-bg-color-value').textContent = qrBgColor.value.toUpperCase();
                if (qrCode && qrContent.value.trim()) {
                    generateQRCode();
                }
            }

            // Обновление размера QR-кода
            function updateQrSize() {
                if (qrCode && qrContent.value.trim()) {
                    generateQRCode();
                }
            }

            // Обновление коррекции ошибок
            function updateQrEcc() {
                if (qrCode && qrContent.value.trim()) {
                    generateQRCode();
                }
            }

            // Переключение опций логотипа
            function toggleLogoOptions() {
                qrLogoOptions.style.display = qrLogoEnabled.checked ? 'block' : 'none';
                if (qrCode && qrLogoEnabled.checked && qrLogoUrl.value.trim() && qrContent.value.trim()) {
                    generateQRCode();
                }
            }

            // Обновление URL логотипа
            function updateLogoUrl() {
                if (qrCode && qrLogoEnabled.checked && qrContent.value.trim()) {
                    generateQRCode();
                }
            }

            // Обновление размера логотипа
            function updateLogoSize() {
                if (qrCode && qrLogoEnabled.checked && qrLogoUrl.value.trim() && qrContent.value.trim()) {
                    generateQRCode();
                }
            }

            // Скачивание QR-кода как PNG
            function downloadQRAsPNG() {
                if (!qrCode) return;

                const canvas = qrcodeDiv.querySelector('canvas');
                if (!canvas) return;

                const link = document.createElement('a');
                link.download = 'qr-code.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            }

            // Скачивание QR-кода как SVG
            function downloadQRAsSVG() {
                if (!qrCode) return;

                const content = qrContent.value.trim();
                const color = qrColor.value.substring(1); // Убираем #
                const bgColor = qrBgColor.value.substring(1);
                const size = parseInt(qrSize.value);
                const ecc = qrEcc.value;

                // Простая SVG реализация QR-кода (может не работать для сложных кодов)
                let svg = `<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">`;
                svg += `<rect width="${size}" height="${size}" fill="#${bgColor}"/>`;
                
                // Здесь должна быть логика преобразования QR-кода в SVG
                // Это упрощенная версия, на практике нужно использовать библиотеку
                svg += `<text x="50%" y="50%" fill="#${color}" text-anchor="middle">QR Code SVG</text>`;
                svg += `</svg>`;

                const blob = new Blob([svg], {type: 'image/svg+xml'});
                const link = document.createElement('a');
                link.download = 'qr-code.svg';
                link.href = URL.createObjectURL(blob);
                link.click();
            }

            // Сохранение QR-кода в историю
            function saveQRToHistory() {
                if (!qrCode || !qrContent.value.trim()) return;

                const content = qrContent.value.trim();
                const type = detectContentType(content);
                const date = new Date().toISOString();
                const id = Date.now().toString();
                const item = {
                    id,
                    type,
                    content,
                    date,
                    isGenerated: true,
                    settings: {
                        color: qrColor.value,
                        bgColor: qrBgColor.value,
                        size: parseInt(qrSize.value),
                        ecc: qrEcc.value,
                        logo: qrLogoEnabled.checked ? qrLogoUrl.value : null,
                        logoSize: qrLogoEnabled.checked ? parseInt(qrLogoSizer.value) : null
                    }
                };

                addToHistory(item);
                showNotification('QR-код сохранен в историю', 'success');
            }

            // Копирование QR-кода в буфер обмена
            function copyQRToClipboard() {
                if (!qrCode) return;

                const canvas = qrcodeDiv.querySelector('canvas');
                if (!canvas) return;

                canvas.toBlob(blob => {
                    navigator.clipboard.write([
                        new ClipboardItem({
                            [blob.type]: blob
                        })
                    ]).then(() => {
                        showNotification('QR-код скопирован в буфер обмена', 'success');
                    }).catch(err => {
                        showNotification('Ошибка копирования QR-кода', 'error');
                        console.error('Ошибка копирования:', err);
                    });
                });
            }

            // Запуск сканера QR-кодов
            function startQRScanner() {
                if (scannerStream) {
                    stopQRScanner();
                }

                navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'environment',
                        width: getCameraResolution().width,
                        height: getCameraResolution().height
                    },
                    audio: false
                }).then(stream => {
                    scannerStream = stream;
                    scannerVideo.srcObject = stream;
                    scannerVideo.play();
                    startScanner.disabled = true;
                    stopScanner.disabled = false;
                    scannerStatus.textContent = 'Сканирование...';

                    if (settings.autoScan) {
                        scannerInterval = setInterval(scanQRCode, 500);
                    }
                }).catch(err => {
                    console.error('Ошибка доступа к камере:', err);
                    scannerStatus.textContent = 'Ошибка доступа к камере';
                    showNotification('Не удалось получить доступ к камере', 'error');
                });
            }

            // Остановка сканера QR-кодов
            function stopQRScanner() {
                if (scannerInterval) {
                    clearInterval(scannerInterval);
                    scannerInterval = null;
                }

                if (scannerStream) {
                    scannerStream.getTracks().forEach(track => track.stop());
                    scannerStream = null;
                    scannerVideo.srcObject = null;
                }

                startScanner.disabled = false;
                stopScanner.disabled = true;
                scannerStatus.textContent = 'Сканер остановлен';
            }

            // Сканирование QR-кода
            function scanQRCode() {
                if (scannerVideo.readyState === scannerVideo.HAVE_ENOUGH_DATA) {
                    scannerCanvas.width = scannerVideo.videoWidth;
                    scannerCanvas.height = scannerVideo.videoHeight;
                    const ctx = scannerCanvas.getContext('2d');
                    ctx.drawImage(scannerVideo, 0, 0, scannerCanvas.width, scannerCanvas.height);
                    
                    const imageData = ctx.getImageData(0, 0, scannerCanvas.width, scannerCanvas.height);
                    const code = jsQR(imageData.data, imageData.width, imageData.height, {
                        inversionAttempts: 'dontInvert'
                    });

                    if (code) {
                        handleScanResult(code.data);
                    }
                }
            }

            // Обработка результата сканирования
            function handleScanResult(result) {
                scannerResult.innerHTML = `<p><strong>Результат сканирования:</strong></p><p>${result}</p>`;
                copyResult.disabled = false;

                if (settings.beepOnScan) {
                    playBeep();
                }

                if (settings.saveHistory) {
                    const type = detectContentType(result);
                    const date = new Date().toISOString();
                    const id = Date.now().toString();
                    const item = {
                        id,
                        type,
                        content: result,
                        date,
                        isGenerated: false
                    };
                    addToHistory(item);
                }

                if (!settings.autoScan) {
                    stopQRScanner();
                }

                showNotification('QR-код успешно отсканирован', 'success');
            }

            // Воспроизведение звукового сигнала
            function playBeep() {
                const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                
                oscillator.type = 'sine';
                oscillator.frequency.value = 1000;
                gainNode.gain.value = 0.1;
                
                oscillator.start();
                gainNode.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 0.5);
                oscillator.stop(audioCtx.currentTime + 0.5);
            }

            // Обработка загрузки изображения
            function handleFileUpload(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        scannerCanvas.width = img.width;
                        scannerCanvas.height = img.height;
                        const ctx = scannerCanvas.getContext('2d');
                        ctx.drawImage(img, 0, 0);
                        
                        const imageData = ctx.getImageData(0, 0, scannerCanvas.width, scannerCanvas.height);
                        const code = jsQR(imageData.data, imageData.width, imageData.height, {
                            inversionAttempts: 'dontInvert'
                        });

                        if (code) {
                            handleScanResult(code.data);
                        } else {
                            scannerResult.innerHTML = '<p>QR-код не найден на изображении</p>';
                            copyResult.disabled = true;
                            showNotification('QR-код не найден', 'error');
                        }
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
                fileInput.value = '';
            }

            // Копирование результата сканирования
            function copyResultToClipboard() {
                const text = scannerResult.textContent.replace('Результат сканирования:', '').trim();
                navigator.clipboard.writeText(text).then(() => {
                    showNotification('Результат скопирован в буфер обмена', 'success');
                }).catch(err => {
                    showNotification('Ошибка копирования результата', 'error');
                    console.error('Ошибка копирования:', err);
                });
            }

            // Очистка результата сканирования
            function clearScannerResult() {
                scannerResult.innerHTML = '<p>Здесь будет отображаться результат сканирования QR-кода.</p>';
                copyResult.disabled = true;
            }

            // Проверка и загрузка истории
            function checkHistory() {
                const savedHistory = localStorage.getItem('qrHistory');
                if (savedHistory) {
                    history = JSON.parse(savedHistory);
                    renderHistory();
                }
            }

            // Добавление в историю
            function addToHistory(item) {
                if (!settings.saveHistory) return;

                history.unshift(item);
                
                // Ограничение истории по настройкам
                if (history.length > settings.historyLimit) {
                    history = history.slice(0, settings.historyLimit);
                }

                localStorage.setItem('qrHistory', JSON.stringify(history));
                renderHistory();
            }

            // Отображение истории
            function renderHistory() {
                if (history.length === 0) {
                    emptyHistory.style.display = 'block';
                    historyList.innerHTML = '';
                    return;
                }

                emptyHistory.style.display = 'none';
                historyList.innerHTML = '';

                history.forEach(item => {
                    const tr = document.createElement('tr');
                    tr.className = 'history-item';
                    
                    const dateTd = document.createElement('td');
                    dateTd.textContent = new Date(item.date).toLocaleString();
                    
                    const contentTd = document.createElement('td');
                    contentTd.className = 'history-content';
                    contentTd.textContent = item.content.length > 100 ? item.content.substring(0, 100) + '...' : item.content;
                    
                    const typeTd = document.createElement('td');
                    const typeBadge = document.createElement('span');
                    typeBadge.className = 'badge ' + (item.isGenerated ? 'secondary' : 'accent');
                    typeBadge.textContent = item.isGenerated ? 'Создан' : 'Сканирован';
                    typeTd.appendChild(typeBadge);
                    
                    const actionsTd = document.createElement('td');
                    actionsTd.className = 'table-actions';
                    
                    const viewBtn = document.createElement('button');
                    viewBtn.className = 'history-btn';
                    viewBtn.textContent = 'Просмотр';
                    viewBtn.addEventListener('click', () => viewHistoryItem(item));
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'history-btn';
                    deleteBtn.textContent = 'Удалить';
                    deleteBtn.addEventListener('click', () => deleteHistoryItem(item.id));
                    
                    actionsTd.appendChild(viewBtn);
                    actionsTd.appendChild(deleteBtn);
                    
                    tr.appendChild(dateTd);
                    tr.appendChild(contentTd);
                    tr.appendChild(typeTd);
                    tr.appendChild(actionsTd);
                    
                    historyList.appendChild(tr);
                });
            }

            // Поиск по истории
            function searchHistory() {
                const query = historySearch.value.toLowerCase();
                const rows = historyList.querySelectorAll('tr');
                
                rows.forEach(row => {
                    const content = row.querySelector('.history-content').textContent.toLowerCase();
                    row.style.display = content.includes(query) ? '' : 'none';
                });
            }

            // Просмотр элемента истории
            function viewHistoryItem(item) {
                if (item.isGenerated) {
                    // Переключение на вкладку генератора
                    document.querySelector('.tab[data-tab="generator"]').click();
                    
                    // Заполнение полей
                    qrContent.value = item.content;
                    qrColor.value = item.settings.color;
                    qrBgColor.value = item.settings.bgColor;
                    qrSize.value = item.settings.size;
                    qrEcc.value = item.settings.ecc;
                    qrLogoEnabled.checked = !!item.settings.logo;
                    if (item.settings.logo) {
                        qrLogoUrl.value = item.settings.logo;
                        qrLogoSizer.value = item.settings.logoSize;
                    }
                    toggleLogoOptions();
                    updateColorValue();
                    updateBgColorValue();
                    
                    // Генерация QR-кода
                    generateQRCode();
                } else {
                    // Переключение на вкладку сканера
                    document.querySelector('.tab[data-tab="scanner"]').click();
                    
                    // Отображение результата
                    scannerResult.innerHTML = `<p><strong>Результат сканирования:</strong></p><p>${item.content}</p>`;
                    copyResult.disabled = false;
                }
            }

            // Удаление элемента истории
            function deleteHistoryItem(id) {
                showModal(
                    'Удаление из истории',
                    'Вы уверены, что хотите удалить этот элемент из истории?',
                    () => {
                        history = history.filter(item => item.id !== id);
                        localStorage.setItem('qrHistory', JSON.stringify(history));
                        renderHistory();
                        showNotification('Элемент удален из истории', 'success');
                    }
                );
            }

            // Подтверждение очистки истории
            function confirmClearHistory() {
                if (history.length === 0) return;
                
                showModal(
                    'Очистка истории',
                    'Вы уверены, что хотите полностью очистить историю? Это действие нельзя отменить.',
                    () => {
                        history = [];
                        localStorage.removeItem('qrHistory');
                        renderHistory();
                        showNotification('История очищена', 'success');
                    }
                );
            }

            // Экспорт истории
            function exportHistoryData() {
                if (history.length === 0) {
                    showNotification('История пуста, нечего экспортировать', 'warning');
                    return;
                }

                const data = {
                    app: 'QR Code Generator & Scanner',
                    version: '1.0.0',
                    exportedAt: new Date().toISOString(),
                    items: history
                };

                const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
                const link = document.createElement('a');
                link.download = `qr-history-${new Date().toISOString().slice(0, 10)}.json`;
                link.href = URL.createObjectURL(blob);
                link.click();
                showNotification('История экспортирована', 'success');
            }

            // Определение типа содержимого
            function detectContentType(content) {
                if (content.startsWith('http://') || content.startsWith('https://')) {
                    return 'URL';
                } else if (content.startsWith('tel:')) {
                    return 'Телефон';
                } else if (content.startsWith('mailto:')) {
                    return 'Email';
                } else if (content.startsWith('BEGIN:VCARD')) {
                    return 'Контакт (vCard)';
                } else if (content.match(/^\d+$/)) {
                    return 'Число';
                } else if (content.match(/^[A-Za-z0-9]+$/)) {
                    return 'Текст';
                } else {
                    return 'Текст';
                }
            }

            // Получение разрешения камеры
            function getCameraResolution() {
                switch (settings.cameraResolution) {
                    case 'hd': return {width: 1280, height: 720};
                    case 'full-hd': return {width: 1920, height: 1080};
                    case '4k': return {width: 3840, height: 2160};
                    default: return {width: 0, height: 0}; // Автоматическое
                }
            }

            // Управление настройками
            function toggleDarkMode() {
                settings.darkMode = darkMode.checked;
                toggleDarkTheme(settings.darkMode);
                saveSettings();
            }

            function toggleSaveHistory() {
                settings.saveHistory = saveHistory.checked;
                saveSettings();
            }

            function toggleNotifications() {
                settings.notifications = notifications.checked;
                saveSettings();
            }

            function updateHistoryLimit() {
                settings.historyLimit = parseInt(historyLimit.value);
                historyLimitValue.textContent = settings.historyLimit;
                
                // Обрезка истории, если новый лимит меньше текущего количества
                if (history.length > settings.historyLimit) {
                    history = history.slice(0, settings.historyLimit);
                    localStorage.setItem('qrHistory', JSON.stringify(history));
                    renderHistory();
                }
                
                saveSettings();
            }

            function toggleAutoGenerate() {
                settings.autoGenerate = autoGenerate.checked;
                saveSettings();
            }

            function updateDefaultQrSize() {
                settings.defaultQrSize = parseInt(defaultQrSize.value);
                qrSize.value = settings.defaultQrSize;
                saveSettings();
            }

            function updateDefaultEcc() {
                settings.defaultEcc = defaultEcc.value;
                qrEcc.value = settings.defaultEcc;
                saveSettings();
            }

            function toggleAutoScan() {
                settings.autoScan = autoScan.checked;
                saveSettings();
            }

            function toggleBeepOnScan() {
                settings.beepOnScan = beepOnScan.checked;
                saveSettings();
            }

            function updateCameraResolution() {
                settings.cameraResolution = cameraResolution.value;
                saveSettings();
            }

            function toggleAnalytics() {
                settings.analytics = analytics.checked;
                saveSettings();
            }

            function toggleSaveToLocal() {
                settings.saveToLocal = saveToLocal.checked;
                saveSettings();
            }

            // Подтверждение удаления всех данных
            function confirmClearAllData() {
                showModal(
                    'Удаление всех данных',
                    'Вы уверены, что хотите удалить ВСЕ данные приложения, включая настройки и историю? Это действие нельзя отменить.',
                    () => {
                        localStorage.clear();
                        history = [];
                        settings = {
                            darkMode: false,
                            saveHistory: true,
                            notifications: true,
                            historyLimit: 100,
                            autoGenerate: true,
                            defaultQrSize: 200,
                            defaultEcc: 'M',
                            autoScan: true,
                            beepOnScan: true,
                            cameraResolution: 'auto',
                            analytics: true,
                            saveToLocal: true
                        };
                        applySettings();
                        renderHistory();
                        clearGenerator();
                        clearScannerResult();
                        showNotification('Все данные удалены', 'success');
                    }
                );
            }

            // Экспорт всех данных приложения
            function exportAllAppData() {
                const data = {
                    app: 'QR Code Generator & Scanner',
                    version: '1.0.0',
                    exportedAt: new Date().toISOString(),
                    settings: settings,
                    history: history
                };

                const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
                const link = document.createElement('a');
                link.download = `qr-app-data-${new Date().toISOString().slice(0, 10)}.json`;
                link.href = URL.createObjectURL(blob);
                link.click();
                showNotification('Все данные экспортированы', 'success');
            }

            // Показ модального окна
            function showModal(title, body, confirmCallback) {
                modalTitle.textContent = title;
                modalBody.innerHTML = `<p>${body}</p>`;
                modal.style.display = 'block';
                
                modalConfirm.onclick = function() {
                    closeModalWindow();
                    if (confirmCallback) confirmCallback();
                };
            }

            // Закрытие модального окна
            function closeModalWindow() {
                modal.style.display = 'none';
            }

            // Подтверждение действия в модальном окне
            function confirmModalAction() {
                closeModalWindow();
            }

            // Показ уведомления
            function showNotification(message, type = 'info') {
                if (!settings.notifications) return;
                
                notification.className = 'notification';
                notification.classList.add(type);
                notificationMessage.textContent = message;
                
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }

            // Инициализация приложения
            initApp();
        });
    </script>
</body>
</html>
